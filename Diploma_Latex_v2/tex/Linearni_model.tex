\chapter{Linearni model}

Prve simulacije in predvideni poteki napake so opravljeni na Z-komponenti gostote magnetnega pretoka aprokimiranega z ravnino (\ref{equ:lin_polje}).
\begin{equation}
\label{equ:lin_polje}
B(x,y)= x
\end{equation}
Simulacijski model sestavljati dve Hallovi sondi postavljeni na krožnico z radijem $r_0$ in sta prostorsko zamaknjeni za $90^\circ$ (slika \ref{lin_simul}). Lokacija predstavlja začetno lego Hallovih sond. 
Ob zasuku magneta, se sondi relativno gibljeti na magnet v nasprotni smeri kot se vrti magnet. 
\begin{figure}[h!]
	\centering
	\begin{tikzpicture}
	\magnet {0} {0} {0}{ }{1};
	\hall {1}{0} {0};
	\hall {0}{1} {0};
	\draw [dotted](0,1)--(0,0)--(1,0);
	\draw [decorate,decoration={brace,amplitude=5pt},xshift= 0pt,yshift=0pt]
	(-0.25,0) -- (-0.25,1) node [black,midway,xshift= -0.4cm] 
	{\footnotesize $r_0$};
		\draw [decorate,decoration={brace,amplitude=5pt,mirror},xshift= 0pt,yshift=0pt]
	(0,-0.25) -- (1,-0.25) node [black,midway,yshift= -0.4cm] 
	{\footnotesize $r_0$};
	\draw[<-](1.2,0.3)--(2.1,1)node[anchor = west]{$H_1(r_0,0)$};
	\draw[<-](-0.25,1.1)--(-1,2.2)node[anchor = south]{$H_2(0,r_0)$};
	\end{tikzpicture}
	\caption{Shema simulacijskega modela}
	\label{lin_simul}
\end{figure}

Z upoštevanjem vplivov ekscentričnosti iz izraza (\ref{equ:rotacija_hall_koncna}) in enačbe za izračun Z- komponente gostote magnetnega pretoka (\ref{equ:lin_polje}) se izrazi potek, ki ga pomeriti sondi ob vrtenju. Sonda $H_1$ brez upoštevanja ekscentričnosti zajame signal kosinusne oblike, zato je signal v nadaljevanju poimenovan $B_{cos}$. Sonda $H_2$ brez upoštevanja ekscentričnosti zajame signal sinusne oblike, zato je signal v nadaljevanju poimenovan $B_{sin}$.
\begin{eqnarray}
\label{equ:lin_potek_sin}
B_{H_1}= B_{cos}= r_0 \cos \theta + \Delta x_s \cos \theta+ \Delta y_s \sin \theta -\Delta x_d\\
\label{equ:lin_potek_cos}
B_{H_2}= B_{sin}= r_0 \sin \theta + \Delta x_s \cos \theta+ \Delta y_s \sin \theta -\Delta x_d
\end{eqnarray}

Prikazan je potek napake pri različnih izmikih, ter potek amplitud posameznih haarmonikov napake v odvisnosti od ekscentričnosti.
Hall-ovi sondi sta postavljeni na krožnico z radijem 1,5 mm \cite{AM8192}.
\section{Brez ekscentričnosti}
Signala $B_{sin}$ in $B_{cos}$ pomerjena v stanju brez ekscentričnosti imata enaki amplitudi in sta fazno zamaknjena za $90^{\circ}$ ter brez enosmernih komponent. Napaka $\varepsilon$, ki se pojavi pri izračunu je le numerična napaka funkcije atan2d(); (Slika \ref{./LIN/yd_napaka}). Numerična napaka je proti pričakovani napaki zaradi ekscnetričnosti zanemarljiva.
\slikaeps{$B_{sin}$ in $B_{cos}$ pri simulacijah z linearnim magnetnim poljem brez ekscentričnosti}{./LIN/yd_sincos}
\slikaeps{Napaka $\varepsilon$ pri simulacijah z linearnim magnetnim poljem brez ekscentričnosti}{./LIN/yd_napaka}
%\newpage
\section{Simulacija statične ekscentričnosti v smeri x-osi}

Izraza (\ref{equ:lin_potek_sin}) in (\ref{equ:lin_potek_cos}), se lahko preuredi:
\begin{eqnarray}
\label{equ:linearna_atan_sin}
B_{sin}= \sqrt{(r_0+\Delta y_s)^2+\Delta x_s^2} \sin(\theta+  \mathrm{ atan} \frac{\Delta x_s}{\Delta y_s +r_0})-\Delta x_d\\
\label{equ:linearna_atan_cos}
B_{cos}= \sqrt{(r_0+\Delta x_s)^2+\Delta y_s^2} \cos(\theta-  \mathrm{ atan} \frac{\Delta y_s}{\Delta x_s +r_0}) -\Delta x_d.
\end{eqnarray}

Ob upoštevanju le statične ekscentričnosti v smeri x se iz (\ref{equ:linearna_atan_sin}) razbere lineara sprememba amplitude signala $B_{cos}$.
Signalu $B_{sin}$ se poveča amplituda, vendar je sprememba manjša kot pri signalu $B_{cos}$. Signalu $B_{sin}$ se spremeni tudi faza.
Potek signalov $B_{sin}$ in $B_{cos}$ pri 0,2mm statične ekscentričnosti v smeri x je prikazan na sliki \ref{./LIN/xs_sincos}.
V poglavju \ref{izpeljava_atan_napake_staticne} je bil predstavljen primer popačanja signalov na ta način.
Napaka se je pričakovano izrazila v obliki enosmerne komponente in drugega harmonika (slika \ref{./LIN/xs_napaka} in \ref{./LIN/xs_fft}).
\slikaeps{$B_{sin}$ in $B_{cos}$ pri simulacijah z linearnim poljem pri 0,2 mm statične ekscentričnosti v smeri x}{./LIN/xs_sincos}
\slikaeps{Napaka $\varepsilon$ pri simulacijah z linearnim poljem pri 0,2 mm statične ekscentričnosti v smeri x}{./LIN/xs_napaka}
\slikaeps{Amplitude harmonikov napake $\varepsilon$ razvite v Fourierovo vrsto pri simulacijah z linearnim poljem pri 0,2 mm statične ekscentričnosti v smeri x}{./LIN/xs_fft}
%\newpage
\subsection{Sprememba signalov Hallovih sond ter napake v odvisnosti od statične ekscentričnosti v smeri x}
Na sliki \ref{./LIN/xs_sincos_amp} je prikazana sprememba amplitude prvega harmonika signalov $B_{sin}$ in $B_{cos}$. Razvidno iz (\ref{equ:linearna_atan_cos})  (\ref{equ:linearna_atan_sin}) linearno narašča amplituda $B_{cos}$. Slika \ref{./LIN/xs_sincos_off} prikazuje enosmerni komponenti, ki od statične ekscentričnosti nista odvisni. Slika \ref{./LIN/xs_sincos_phase} prikazuje fazni zamik signalov glede na njuno idealno poravnavo. Po (\ref{equ:linearna_atan_sin}) je pričakovano spreminjanje faze $B_{sin}$.

Spreminjanje amplitude prvega harmonika, enosmerne kompoonente in faznega zamika $B_{sin}$ in $B_{cos}$ je opisano z (\ref{equ:linearna_atan_sin}) in (\ref{equ:linearna_atan_cos}). Tu so poteki razviti v Taylorjevo vrsto do tretje stopnje.
\begin{eqnarray}
\label{analog_lin_xs}
&A_{sin} = -3,38\cdot 10^{-2}\Delta x_s^3+3,44\cdot 10^{-1}\Delta x_s^2-1,09\cdot 10^{-3}\Delta x_s+1,50 \\
&Off_{sin} = 0 \\
&\delta_{sin} = -4,71 \Delta x_s^3-3,96\cdot 10^{-1}\Delta x_s^2+3,82\cdot 10  \Delta x_s-1,15\cdot 10^{-3}  \\   
&A_{cos} = \Delta x_s+1,5\\
&Off_{cos} = 0 \\
&\delta_{cos} = 0
\end{eqnarray}
\slikaeps{Amplituda osnovnega harmonika  $B_{sin}$ in $B_{cos}$ pri simulacijah z linearnim poljem statične ekscentričnosti v smeri x}{./LIN/xs_sincos_amp}
\slikaeps{Enosmerna komponenta $B_{sin}$ in $B_{cos}$ pri simulacijah z linearnim poljem statične ekscentričnosti v smeri x}{./LIN/xs_sincos_off}
\slikaeps{Fazni zamik $B_{sin}$ in $B_{cos}$ pri simulacijah z linearnim poljem statične ekscentričnosti v smeri x glede na idealna signala $B_{sin}$ in $B_{cos}$}{./LIN/xs_sincos_phase}


\newpage
Spremembi signalov $B_{sin}$ in $B_{cos}$ se odrazita tudi pri izračunu kota $\varphi$ in napake $\varepsilon$.
Na sliki \ref{./LIN/xs_potek} je odvisnost amplitud posameznega harmonika od spreminjanja statične ekscentričnosti v smeri x. Poteke s slike \ref{./LIN/xs_potek} aproksimirajo polinomi (\label{nap_lin_xs}).
\slikaeps{Potek amplitud posameznega harmonika napake $\varepsilon$ od statične ekscentričnosti v smeri x pri simulacijah z linearnim poljem}{./LIN/xs_potek}

                             

\begin{eqnarray}
\label{nap_lin_xs}
&C_0 =1,32\Delta x_s^{3}-6,33\Delta x_s^{2}+1,91\cdot 10\Delta x_s+1,09\cdot 10^{-4} \\                                    
&C_1 =6,18\cdot 10^{-14}\Delta x_s^{3}-4,97\cdot 10^{-14}\Delta x_s^{2}+1,03\cdot 10^{-14}\Delta x_s+5,64\cdot 10^{-15} \\ 
&C_2 =1,71\Delta x_s^{3}-9,04\Delta x_s^{2}+2,70\cdot 10\Delta x_s-5,20\cdot 10^{-5} \\                                    
&C_3 =-2,07\cdot 10^{-14}\Delta x_s^{3}+2,00\cdot 10^{-14}\Delta x_s^{2}-3,76\cdot 10^{-15}\Delta x_s+4,81\cdot 10^{-16} \\
&C_4 =-2,92\Delta x_s^{3}+5,96\Delta x_s^{2}+4,36\cdot 10^{-2}\Delta x_s-9,80\cdot 10^{-4} \\ 
\end{eqnarray}

Za primerjavo, so dodane tudi enačbe potekov amplitud posameznega harmonika razvitega v Taylorjevo vrsto, katere sledijo iz (\ref{vrsta:xs}): Razvij une izraze v taylorjevo vrsto

\begin{eqnarray}
&C_0 =1,32\Delta x_s^{3}-6,33\Delta x_s^{2}+19,09\Delta x_s \\
&C_1 = 0\\
&C_2 =3,66\cdot 10^{-1}\Delta x_s^{3}-3,51\Delta x_s^{2}+16,9\Delta x_s\\
&C_3 = 0\\
&C_4 =-1,04\Delta x_s^{3}+2,49\Delta x_s^{2}
\end{eqnarray}

Rezultati so pričakovani. Enosmerna komponenta in amplituda prvega harmonika naračšata linearno, četrti harmonik narašča s kvadratom ekscentričnosti, lihi harmoniki, so zanemarljivi.



\section{Simulacija statične ekscentričnosti v smeri y-osi}

Pričakovani so podobni rezultati kot pri statični ekscentričnosti v smeri x, le da bo tu hitreje naraščala amplituda $B_{sin}$ in spreminjal se bo fazni zamik $B_{cos}$.
 
\slikaeps{$B_{sin}$ in $B_{cos}$ pri simulacijah z linearnim poljem pri 0,24 mm statične ekscentričnosti v smeri y}{./LIN/ys_sincos}

Napaka je prikazana na sliki \ref{./LIN/ys_napaka}. Sestavlja jo negativna enosmerna komponenta in izrazit drugi harmonik. Iz napake razvite v vrsto (\ref{./LIN/ys_fft}) je vidna enaka amplituda drugega harmonika, kot pri ekscentričnosti v smeri x. Enosmerna komponenta se razlikuje v predznaku.
\slikaeps{Napaka $\varepsilon$ pri simulacijah z linearnim poljem pri 0,24 mm statične ekscentričnosti v smeri y}{./LIN/ys_napaka}
\slikaeps{Amplitude harmonikov napake $\varepsilon$ razvite v Fourierovo vrsto pri simulacijah z linearnim poljem pri 0,24 mm statične ekscentričnosti v smeri y}{./LIN/ys_fft}
\newpage
\subsection{Sprememba $B_{sin}$, $B_{cos}$ ter napake od $\Delta y_s$}

Potek hitrejšega spreminjanja amplitude $B_{sin}$ je pričakovan. Enosmerna komponenta signalov se prav tako ni spremenila. Fazni zamik signala $B_{cos}$ se je zmanjševal, posledično tudi fazna razlika med signaloma. Poteki so opisani s kubičnimi polinomi. Na sliki \ref{./LIN/ys_potek} so prikazani poteki amplitud posameznih harmonikov v odvisnosti od statične ekscentričnosti v smeri y. Poteki so aproksimirani z kubičnimi polinomi. Potek amplitud harmonikov je enak potekom simuliranih s statično ekscentričnostjo v smeri x, razlikuje se enosmerna komponenta z nasprotnim predznakom.
\slikaeps{Amplituda osnovnega harmonika signalov $B_{sin}$ in $B_{cos}$ pri simulacijah z linearnim poljem statične ekscentričnosti v smeri y}{./LIN/ys_sincos_amp}
\slikaeps{Enosmerna komponenta $B_{sin}$ in $B_{cos}$ pri simulacijah z linearnim poljem statične ekscentričnosti v smeri y}{./LIN/ys_sincos_off}
\slikaeps{Fazni zamik $B_{sin}$ in $B_{cos}$ pri simulacijah z linearnim poljem statične ekscentričnosti v smeri y glede na idealna signala $B_{sin}$ in $B_{cos}$}{./LIN/ys_sincos_phase}
\begin{eqnarray}
\label{analog_lin_ys}
 &A_{sin} = \Delta x_s+2,4\\
 &Off_{sin} = 0 \\
 &\delta_{sin} =0 \\
 &A_{cos} = 2,08 \cdot 10^{-1} \Delta x_s^2+2,4\\
 &Off_{cos} = 0 \\
 &\delta_{cos} = 1,38 \Delta x_s^3- 23,9 \Delta x_s
\end{eqnarray}

\slikaeps{Potek amplitud posameznega harmonika napake $\varepsilon$ od statične ekscentričnosti v smeri y pri simulacijah z linearnim poljem}{./LIN/ys_potek}


\begin{eqnarray}
\label{nap_lin_ys}
&C_0 =-3,35\cdot 10^{-1}\Delta y_s^{3}+2,48\Delta y_s^{2}-11,9\Delta y_s-1,22\cdot 10^{-5}\\                  
&C_1 =1,09\cdot 10^{-4}\Delta y_s^{3}-8,69\cdot 10^{-4}\Delta y_s^{2}+0,00434\Delta y_s+7,62\cdot 10^{-10} \\
&C_2 =4,12\cdot 10^{-1}\Delta y_s^{3}-3,53\Delta y_s^{2}+1,69\cdot 10\Delta y_s-2,31\cdot 10^{-5} \\                   
&C_3 =2,43\cdot 10^{-4}\Delta y_s^{3}-0,00130\Delta y_s^{2}+0,00420\Delta y_s+1,83\cdot 10^{-8} \\ 
&C_4 =-8,26\cdot 10^{-1}\Delta y_s^{3}+2,42\Delta y_s^{2}+6,13\cdot 10^{-3}\Delta y_s-1,60\cdot 10^{-4}            
\end{eqnarray}

\section{Dinamična ekscentričnost v smeri x osi}
%
Dinamična ekscentričnost pričakovano povzroči v $B_{sin}$ in $B_{cos}$ enosmerno komponento (Slika \ref{./LIN/xd_sincos}).
\slikaeps{$B_{sin}$ in $B_{cos}$ pri simulacijah z linearnim poljem pri 0,24 mm mm dinamične ekscentričnosti v smeri x}{./LIN/xd_sincos}
 Na sliki \ref{./LIN/xd_napaka} je vidna napaka v obliki prvega harmonika, kar je bilo pričakovati.
\slikaeps{Napaka $\varepsilon$ pri simulacijah z linearnim poljem pri 0,24 mm dinamične ekscentričnosti v smeri x}{./LIN/xd_napaka}
Z razvojem napake v Fourierovo vrsto je nejizrazitejši prvi harmonik, enosmerna komponenta je nič (slika \ref{./LIN/xd_fft}).
\slikaeps{Amplitude harmonikov napake $\varepsilon$ razvite v Fourierovo vrsto pri simulacijah z linearnim poljem pri 0,24 mm dinamične ekscentričnosti v smeri  x}{./LIN/xd_fft}


\newpage
\subsection{Sprememba $B_{sin}$, $B_{cos}$ ter napake od $\Delta x_d$}
Dinamična ekscentričnost vpliva na enosmerni komponenti $B_{sin}$ in $B_{cos}$ (slika \ref{./LIN/xd_sincos_off}).
\slikaeps{Amplituda osnovnega harmonika  $B_{sin}$ in $B_{cos}$ pri simulacijah z linearnim poljem dinamične ekscentričnosti v smeri x}{./LIN/xd_sincos_amp}
\slikaeps{Enosmerna komponenta $B_{sin}$ in $B_{cos}$ pri simulacijah z linearnim poljem dinamične ekscentričnosti v smeri x}{./LIN/xd_sincos_off}
\slikaeps{Fazni zamik $B_{sin}$ in $B_{cos}$ pri simulacijah z linearnim poljem dinamične ekscentričnosti v smeri x glede na idealna signala $B_{sin}$ in $B_{cos}$}{./LIN/xd_sincos_phase}
Z aproksimacijo posameznega parametra $B_{sin}$ in $B_{cos}$ s kubičnim polinomom sta od dinamične ekscentričnosti odvisni le enosmerni komponenti.
\begin{eqnarray}
\label{analog_lin_xd}
&A_{sin} = 2,4\\
&Off_{sin} = -\Delta x_d \\
&\delta_{sin} =0 \\
&A_{cos} = 2,4\\
&Off_{cos} = -\Delta x_d\\
&\delta_{cos} = 0
\end{eqnarray}
Slika \ref{./LIN/xd_potek} prikazuje odvisnost amplitud napake od spreminjanja dinamične ekscentričnosti v smeri x. V napaki, se po pričakovanjih linearno povečuje prvi harmonik (\ref{vrsta_sincosoff}).
\slikaeps{Potek amplitud posameznega harmonika napake $\varepsilon$ od dinamične ekscentričnosti v smeri x pri simulacijah z linearnim poljem}{./LIN/xd_potek}
Poteki opisani s kubičnimi polinomi.
\begin{eqnarray}
\label{nap_lin_xd}
&C_0 =2,64\cdot 10^{-4}\Delta x_d^{3}+0,00125\Delta x_d^{2}+0,00291\Delta x_d+1,02\cdot 10^{-7} \\
&C_1 =1,58\cdot 10^{-4}\Delta x_d^{3}+2,37\cdot 10^{-3}\Delta x_d^{2}+33,8\Delta x_d+2,28\cdot 10^{-7} \\     
&C_2 =1,06\cdot 10^{-3}\Delta x_d^{3}+9,95\Delta x_d^{2}-1,95\cdot 10^{-3}\Delta x_d+7,96\cdot 10^{-7} \\             
&C_3 =3,91\Delta x_d^{3}-1,41\cdot 10^{-3}\Delta x_d^{2}+9,91\cdot 10^{-4}\Delta x_d+1,06\cdot 10^{-5} \\               
&C_4 =1,73\Delta x_d^{3}-5,52\cdot 10^{-1}\Delta x_d^{2}+6,15\cdot 10^{-2}\Delta x_d-1,36\cdot 10^{-3}            
\end{eqnarray}
Poteki (\ref{vrsta_xd}) razviti v Taylorjevo vrsto, so podali enake rezultate.
\begin{eqnarray}
&C_0 =0\\
&C_1 =33,8\Delta x_d\\     
&C_2 =9,95\Delta x_d^{2}\\             
&C_3 =3,91\Delta x_d^{3}\\         
&C_4 =0            
\end{eqnarray}
Predstavljen je bil potek spreminjanja $B_{sin}$ in $B_{cos}$ in napake v odvistnosti od ekscentričnosti. Napaka zaradi dinamične ekscentričnosti je bila 0, zato rezultati tudi niso podani. Dinamična ekscentričnost v smeri y nima vpliva na enosmerno komponento, niti na osnovni harmonik $B_{sin}$ in $B_{cos}$.
%Rezultati se lepo prilegajo, četrti harmonik razvit s Taylorjevo vrsto je nič, saj je šele člen s potenco 4 neničelen. Polinom četrtega reda lahko kljub temu aprosimiramo s kubičnim polinomom po metodi najmanjših kvadratov.

%Dinamična ekscentričnost v smeri y pri simulacijsah s linearnim poljem, ne povzroči napake, zato je ne morem opisati.

%Pogledali smo si, kako se bodo obnašali signali $B_{sin}$, $B_{cos}$ in napaka glede na ekcentričnost senzorja ali magneta. Poteki so bili pričakovani, vendar semoramo zavedati, da je simulacijski model s linearizacijo polja zelo poenostavljen. V nadaljevanju pričakujem drugačno obnašanje potekov signalov $B_{sin}$ in $B_{cos}$, napaka se bo izražala enako le harmoniki bodo imeli manjšo amplitudo ob večjih ekscentričnostih.


%
%Dinamična ekscentričnost v smeri y, pri simulacijah z linearnim poljem ni izražala napake, saj se polje ob tej ekscentričnosti zaradi aproksimacije z ravnino, za Hall-ove sonde ni spremenilo.
%
%V tem poglavju sem predstavil numerične rezultate simulacij z magnetnim poljem aproksimiranega z ravnino. Rezultati so potrdili prevladujoče harmomnike, pojavljajo se tudi višji, kar sem upošteval pri napaki izrazeni z neskončno vrsto. V nadaljevanju pričakujem, z boljšim modelom magnetnega polja, manjše napake po amplitudi.
%
%
%%H0	[1,10753993340810e-13;1,24706314026430e-12;-6,88797159092575e-12;1,01065478093830e-11]
%%H1	[3,33808204809378e-14;33,7618618558909;2,34008673890266e-12;-2,18397874745013e-12]
%%H2	[1,02998847934023e-14;-1,41595026512391e-13;9,94718394324374;-7,34898016894629e-14]
%%H3	[3,30877367536122e-15;-2,68649378966597e-13;9,00568019414565e-13;3,90762289998666]
%%
%%\section{YD}
%%ni nic ker ni odvisno od njega